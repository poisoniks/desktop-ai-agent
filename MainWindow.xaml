<Window x:Class="TrayPopupApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TrayPopupApp"
        Title="Tray Popup App" Width="900" Height="600"
        Loaded="Window_Loaded"
        Background="#1F1F1F"
        WindowStartupLocation="Manual">
	<Window.Resources>
		<DropShadowEffect x:Key="FloatShadow" ShadowDepth="2" BlurRadius="8" Direction="180" Opacity="0.35"/>

		<SolidColorBrush x:Key="ContentBg" Color="#23262A"/>
		<SolidColorBrush x:Key="Divider"   Color="#2E3237"/>
		<SolidColorBrush x:Key="TabBg"     Color="#2D2F33"/>
		<SolidColorBrush x:Key="TabBgHover" Color="#3A3D42"/>
		<SolidColorBrush x:Key="TabBgActive" Color="#44484E"/>
		<SolidColorBrush x:Key="AddTabBg"  Color="#1E90FF"/>
		<SolidColorBrush x:Key="IconBrush" Color="#FFFFFFCC"/>

		<DataTemplate DataType="{x:Type local:TabItemVm}">
			<ToggleButton
                IsChecked="{Binding IsSelected, Mode=TwoWay}"
                Click="TabButton_Click"
                Tag="{Binding}"
                Width="48" Height="48"
                Margin="-1,8,0,0"
				Focusable="False"
				Foreground="{StaticResource IconBrush}"
				Cursor="Hand">
				<ToggleButton.Template>
					<ControlTemplate TargetType="ToggleButton">
						<Border x:Name="bd"
                                Width="48" Height="48"
                                CornerRadius="0,10,10,0"
                                Background="{StaticResource TabBg}"
                                BorderBrush="#30000000" BorderThickness="1"
                                Effect="{StaticResource FloatShadow}">
							<Grid>
								<Viewbox Stretch="Uniform">
									<Path Data="{Binding Icon}"
                                          Stretch="Uniform"
                                          Margin="10"
                                          StrokeThickness="2"
                                          Stroke="{TemplateBinding Foreground}"
                                          Fill="{TemplateBinding Foreground}"/>
								</Viewbox>

								<Grid x:Name="Spinner" Visibility="Collapsed">
									<Grid.RenderTransform>
										<RotateTransform Angle="0" CenterX="24" CenterY="24"/>
									</Grid.RenderTransform>
									<Viewbox Stretch="Uniform">
										<Path Data="M24,6 A18,18 0 0 1 42,24"
                                              Stroke="{TemplateBinding Foreground}" StrokeThickness="4"
                                              Fill="Transparent" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
									</Viewbox>
									<Grid.Triggers>
										<EventTrigger RoutedEvent="Loaded">
											<BeginStoryboard>
												<Storyboard RepeatBehavior="Forever">
													<DoubleAnimation
                                                        Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                        From="0" To="360" Duration="0:0:1.2" />
												</Storyboard>
											</BeginStoryboard>
										</EventTrigger>
									</Grid.Triggers>
								</Grid>
							</Grid>
						</Border>

						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="bd" Property="Background" Value="{StaticResource TabBgHover}"/>
							</Trigger>
							<Trigger Property="IsChecked" Value="True">
								<Setter TargetName="bd" Property="Background" Value="{StaticResource TabBgActive}"/>
							</Trigger>

							<DataTrigger Binding="{Binding IsAddButton}" Value="True">
								<Setter TargetName="bd" Property="Background" Value="{StaticResource AddTabBg}"/>
							</DataTrigger>

							<DataTrigger Binding="{Binding IsLoading}" Value="True">
								<Setter TargetName="Spinner" Property="Visibility" Value="Visible"/>
							</DataTrigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</ToggleButton.Template>
			</ToggleButton>
		</DataTemplate>
	</Window.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition/>
			<ColumnDefinition Width="Auto"/>
		</Grid.ColumnDefinitions>

		<Border Grid.Column="0"
                Background="{StaticResource ContentBg}"
                BorderBrush="{StaticResource Divider}" BorderThickness="0,0,1,0">
			<ContentPresenter Content="{Binding SelectedTab.Content}"/>
		</Border>

		<Grid Grid.Column="1" HorizontalAlignment="Right" Background="Transparent">
			<Border Background="Transparent" Width="56" Padding="0,8,8,8">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled"
                              CanContentScroll="True" PanningMode="VerticalFirst">
					<ItemsControl ItemsSource="{Binding Tabs}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<StackPanel Orientation="Vertical"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
					</ItemsControl>
				</ScrollViewer>
			</Border>
		</Grid>
	</Grid>
</Window>
